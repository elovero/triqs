
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Reproducibility, provenance. &#8212; TRIQS 2.2.0 documentation</title>
    <link rel="stylesheet" href="../../../../_static/triqs2.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../../../_static/triqs2.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=default"></script>
    <link rel="author" title="About these documents" href="../../../../about.html" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
  <link rel="stylesheet" href="https://use.typekit.net/hsv6sot.css">
  <script type="text/javascript">try{Typekit.load();}catch(e){}</script>

  </head>
<body class="layout">

  <header class="header">
    <nav class="header-content">
      <div class="row header-row">
        <div class="col-xs-2 logo-col">
          <div class="row start-xs">
            <div class="nav-item">
              <a class="nav-link" href="/"
                ><span class="nav-logo">TRIQS</span></a
              >
            </div>
          </div>
        </div>
        <div class="col-xs-6">
          <div class="row">
            <div class="nav-item">
              <a class="nav-link" href="/documentation.html">Docs</a>
            </div>
            <div class="nav-item">
              <a class="nav-link" href="/tutorials.html">Tutorials</a>
            </div>
            <div class="nav-item">
              <a class="nav-link" href="/applications.html">Applications</a>
            </div>
            <div class="nav-item">
              <a class="nav-link" href="/community.html">Community</a>
            </div>
          </div>
        </div>
        <div class="col-xs-4">
          <div class="row end-xs">
            <div class="nav-item">
              <a class="nav-link" href="/about.html">About</a>
            </div>
            <div class="nav-item">
              <a class="nav-link" target="_blank" noopener noreferrer href="https://github.com/TRIQS/triqs">Github</a>
            </div>
          </div>
        </div>
      </div>
    </nav>
  </header>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="reproducibility-provenance">
<h1>Reproducibility, provenance.<a class="headerlink" href="#reproducibility-provenance" title="Permalink to this headline">¶</a></h1>
<p>Scientific numerical calculations are … scientific calculations.</p>
<p>Hence, like any other kind of calculations, according to the basic principles of science,
everyone should be able to reproduce them, reuse or modify them.
Therefore, the detailed instructions leading to results or figures
should be published along with them.
To achieve these goals, in practice we need to be able to do simply the following things:</p>
<ul class="simple">
<li><p>Store along with the data the version of the code used to produced them (or even the code itself!),
and the configuration options of this code.</p></li>
<li><p>Keep with the figures all the instructions (i.e. the script) that have produced it.</p></li>
<li><p>We want to do that <strong>easily at no cost in human time</strong>, and hence
without adding a new layer of tools (which means new things to learn,
which takes time, etc.).
Indeed this task is important but admittedly extremely boring for physicists!</p></li>
</ul>
<p>Fortunately, python helps solve these issues easily and efficiently.</p>
<p>TRIQS adds very little to the standard python tools here.
So this page should be viewed more as a wiki page of examples.
TRIQS does not impose any framework on you, it just provides tools
and lets you organize your work as you wish.</p>
<div class="section" id="triqs-code-version">
<h2>TRIQS code version<a class="headerlink" href="#triqs-code-version" title="Permalink to this headline">¶</a></h2>
<p>The tiny module <code class="docutils literal notranslate"><span class="pre">pytriqs.version</span></code> contains various pieces of information
configured automatically at compile time</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pytriqs.version</span> <span class="k">import</span> <span class="o">*</span>

<span class="n">version</span>    <span class="c1"># The version of the TRIQS library</span>
<span class="n">release</span>    <span class="c1"># The release number of the library</span>
<span class="n">git_hash</span>   <span class="c1"># The git commit used at compilation</span>

<span class="c1"># publishing this information may lead to a security issue....</span>
<span class="n">show_machine_info</span><span class="p">()</span>   <span class="c1"># Hostname and login of the compilation</span>
</pre></div>
</div>
</div>
<div class="section" id="saving-the-script-in-the-data-archive">
<h2>Saving the script in the data archive<a class="headerlink" href="#saving-the-script-in-the-data-archive" title="Permalink to this headline">¶</a></h2>
<p>It is actually very simple to  save the script
(hence the parameters) along with the data,
simply by putting it in the HDFArchive, e.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ... computation ...</span>
<span class="n">Results</span> <span class="o">=</span> <span class="n">HDFArchive</span><span class="p">(</span><span class="s2">&quot;solution.h5&quot;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">Results</span><span class="p">[</span><span class="s2">&quot;G&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">G</span> <span class="c1"># save the results</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">pytriqs.version</span> <span class="k">as</span> <span class="nn">version</span>
<span class="n">Results</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">log</span> <span class="o">=</span> <span class="n">Results</span><span class="p">[</span><span class="s2">&quot;log&quot;</span><span class="p">]</span>
<span class="n">log</span><span class="p">[</span><span class="s2">&quot;code_version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">version</span><span class="o">.</span><span class="n">release</span>
<span class="n">log</span><span class="p">[</span><span class="s2">&quot;script&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="c1"># read myself !</span>
</pre></div>
</div>
<p>The script that is currently being executed will be copied into the file <cite>solution.h5</cite>, under the subgroup <cite>/log/script</cite>.</p>
<p>In a more complex situation, you may decompose your computation in several scripts, e.g.</p>
<ul class="simple">
<li><p>A script common.py, with some common functions, classes…</p></li>
<li><p>A little one, computation1.py for each computations.</p></li>
</ul>
<p>In such situation, one can simply use the <cite>inspect</cite> module of the python standard library e.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">common</span>
<span class="c1"># set parameters</span>
<span class="c1"># run...</span>
<span class="c1"># save...</span>
<span class="c1"># Ok, I need to save common too !</span>
<span class="kn">import</span> <span class="nn">inspect</span><span class="o">,</span><span class="nn">sys</span><span class="o">,</span> <span class="nn">pytriqs.version</span> <span class="k">as</span> <span class="nn">version</span>
<span class="n">log</span> <span class="o">=</span> <span class="n">Results</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">log</span><span class="p">[</span><span class="s2">&quot;code_version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">version</span><span class="o">.</span><span class="n">release</span>
<span class="n">log</span><span class="p">[</span><span class="s2">&quot;script&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">log</span><span class="p">[</span><span class="s2">&quot;common&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">common</span><span class="p">)</span> <span class="c1"># This retrieves the source of the module in a string</span>
</pre></div>
</div>
</div>
<div class="section" id="from-the-data-to-the-figures">
<h2>From the data to the figures<a class="headerlink" href="#from-the-data-to-the-figures" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>TO BE WRITTEN</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../../../contents.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Reproducibility, provenance.</a><ul>
<li><a class="reference internal" href="#triqs-code-version">TRIQS code version</a></li>
<li><a class="reference internal" href="#saving-the-script-in-the-data-archive">Saving the script in the data archive</a></li>
<li><a class="reference internal" href="#from-the-data-to-the-figures">From the data to the figures</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../../../_sources/documentation/manual/triqs/provenance/contents.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  

  <footer>
    <div class="container-fluid">
      <div class="row footer">
        <div class="col-xs-12 center-xs middle-xs">
          <p class="updated">Updated on November 20, 2019 (2:20pm)</p>
          <div class="outro">
            <p class="footer-description">
              TRIQS (Toolbox for Research on Interacting Quantum Systems) is a
              scientific project providing a set of C++ and Python libraries to
              develop new tools for the study of interacting quantum systems based
              at the Center for Computational Quantum Physics at the Flatiron
              Institute.
            </p>
          </div>
          <ul class="footer-links">
            <li class="footer-link">
              <a exact="true" href="/about">About</a>
            </li>
            <li class="footer-link">
              <a
                target="_blank"
                rel="noopener noreferrer"
                href="https://simonsfoundation.org"
                >Simons Foundation</a
              >
            </li>
            <li class="footer-link">
              <a
                target="_blank"
                rel="noopener noreferrer"
                href="https://flatironinstitute.org"
                >Flatiron Institute</a
              >
            </li>
            <li class="footer-link"><a exact="true" href="/">Github</a></li>
            <li class="footer-link"><a exact="true" href="/contact">Contact</a></li>
          </ul>
        </div>
      </div>
    </div>
  </footer>

  </body>
</html>