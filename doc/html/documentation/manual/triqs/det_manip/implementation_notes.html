
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>How does it work ? &#8212; TRIQS Docs</title>
    <link rel="stylesheet" href="../../../../_static/triqs2.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../../../_static/triqs2.js"></script>
    <script type="text/javascript" src="../../../../_static/prism.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=default"></script>
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../../../../about.html" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
<link rel="stylesheet" href="https://use.typekit.net/hsv6sot.css" />
<link href="/_static/prism.css" rel="stylesheet" />
<script type="text/javascript">
  try {
    Typekit.load();
  } catch (e) {}
</script>

  </head>
<body>
  
  <header class="header">
    <nav class="header-content">
      <div class="row header-row">
        <div class="col-xs-2 logo-col">
          <div class="row start-xs">
            <div class="nav-item">
              <a class="nav-link" href="/"
                ><span class="nav-logo">TRIQS</span></a
              >
            </div>
          </div>
        </div>
        <div class="col-xs-6">
          <div class="row">
            <div class="nav-item">
              <a class="nav-link" href="/documentation.html">Docs</a>
            </div>
            <div class="nav-item">
              <a class="nav-link" href="/tutorials.html">Tutorials</a>
            </div>
            <div class="nav-item">
              <a class="nav-link" href="/applications.html">Applications</a>
            </div>
            <div class="nav-item">
              <a class="nav-link" href="/community.html">Community</a>
            </div>
          </div>
        </div>
        <div class="col-xs-4">
          <div class="row end-xs">
            <div class="nav-item">
              <a class="nav-link" href="/about.html">About</a>
            </div>
            <div class="nav-item">
              <a
                class="nav-link"
                target="_blank"
                rel="noopener noreferrer"
                href="https://github.com/TRIQS/triqs"
                >Github</a
              >
            </div>
          </div>
        </div>
      </div>
    </nav>
  </header>
    

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="how-does-it-work">
<h1>How does it work ?<a class="headerlink" href="#how-does-it-work" title="Permalink to this headline">¶</a></h1>
<p>We give here the mathematical formulas used in the det_manip class.
As this class mainly contains the determinant and the inverse of a matrix <span class="math notranslate nohighlight">\(A\)</span>, we need to know how to update these two members as operations are performed (addition/removal/replacement of one/two lines).</p>
<div class="section" id="cofactors">
<h2>Cofactors<a class="headerlink" href="#cofactors" title="Permalink to this headline">¶</a></h2>
<p>For any <span class="math notranslate nohighlight">\(n\times n\)</span> matrix <span class="math notranslate nohighlight">\(A\)</span>, its inverse (if it is defined) is related to the matrix of its cofactors <span class="math notranslate nohighlight">\(\rm{Cof}\)</span> through:</p>
<div class="math notranslate nohighlight">
\[A\,{\rm Cof}(A^T) = {\rm Det}A\, I_n.\]</div>
<p>The matrix of the cofactors is defined as:</p>
<div class="math notranslate nohighlight">
\[\begin{split}{\rm Cof}(A)_{i,j}
=(-1)^{i+j}{\rm Det}\begin{pmatrix}
a_{1,1}   &amp; \dots &amp; a_{1,j-1}   &amp; a_{1,j+1}  &amp; \dots &amp; a_{1,n}   \\
\vdots    &amp;       &amp; \vdots      &amp; \vdots     &amp;       &amp; \vdots    \\
a_{i-1,1} &amp; \dots &amp; a_{i-1,j-1} &amp; a_{i-1,j+1}&amp; \dots &amp; a_{i-1,n} \\
a_{i+1,1} &amp; \dots &amp; a_{i+1,j-1} &amp; a_{i+1,j+1}&amp; \dots &amp; a_{i+1,n} \\
\vdots    &amp;       &amp; \vdots      &amp; \vdots     &amp;       &amp; \vdots    \\
a_{n,1}   &amp; \dots &amp; a_{n,j-1}   &amp; a_{n,j+1}  &amp; \dots &amp; a_{n,n}   \end{pmatrix}.\end{split}\]</div>
</div>
<div class="section" id="the-sherman-morrison-formula">
<h2>The Sherman-Morrison formula<a class="headerlink" href="#the-sherman-morrison-formula" title="Permalink to this headline">¶</a></h2>
<p><span class="math notranslate nohighlight">\(A\)</span> is an invertible <span class="math notranslate nohighlight">\(n\times n\)</span> matrix, and <span class="math notranslate nohighlight">\(u\)</span>, <span class="math notranslate nohighlight">\(v\)</span> are <span class="math notranslate nohighlight">\(n\)</span> vectors.
Suppose furthermore that <span class="math notranslate nohighlight">\(1+v^t A^{-1} u != 0\)</span>.
Then the Sherman-Morrison formula states that</p>
<div class="math notranslate nohighlight">
\[(A + u v^t)^{-1} = A^{-1} - \frac{ A^{-1} u v^t A^{-1} }{ 1 + v^t A^{-1} u}\]</div>
<p>Similar formula for the determinant:</p>
<div class="math notranslate nohighlight">
\[{\rm Det}(A + u v^t) = Det(A)(1 + v^t A^{-1} u).\]</div>
</div>
<div class="section" id="addition-of-a-line-and-a-column-or-more">
<h2>Addition of a line and a column, or more<a class="headerlink" href="#addition-of-a-line-and-a-column-or-more" title="Permalink to this headline">¶</a></h2>
<p><span class="math notranslate nohighlight">\(A\)</span> is an invertible <span class="math notranslate nohighlight">\(n\times n\)</span> matrix. <span class="math notranslate nohighlight">\(A'\)</span> is a <span class="math notranslate nohighlight">\((n+1)\times (n+1)\)</span> matrix obtained by adding a line and a column to <span class="math notranslate nohighlight">\(A\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}A'=\begin{pmatrix}
A &amp; B \\
C &amp; D \end{pmatrix}.\end{split}\]</div>
<p><span class="math notranslate nohighlight">\(B\)</span> is a column and <span class="math notranslate nohighlight">\(C\)</span> a line both of size <span class="math notranslate nohighlight">\(n\)</span>.
<span class="math notranslate nohighlight">\(D\)</span> is a scalar.</p>
<p>Using the following variables:</p>
<div class="math notranslate nohighlight">
\[\xi=D-C A^{-1} B, \qquad B'=A^{-1}B, \qquad C'=CA^{-1},\]</div>
<p>and the previous formula with the cofactors, we get the determinant and the inverse of <span class="math notranslate nohighlight">\(A'\)</span> as:</p>
<div class="math notranslate nohighlight">
\[\frac{{\rm Det}A'}{{\rm Det}A}={\rm Det}\xi.\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}(A')^{-1}=
\begin{pmatrix}
  A^{-1}+ B'\xi^{-1}C' &amp; -B'\xi^{-1} \\
  -\xi^{-1}C'          &amp;  \xi^{-1}
\end{pmatrix}\end{split}\]</div>
<p>For the addition of two or more lines and columns, the formulas remain the same, but <span class="math notranslate nohighlight">\(B\)</span>, <span class="math notranslate nohighlight">\(C\)</span>, <span class="math notranslate nohighlight">\(D\)</span>, <span class="math notranslate nohighlight">\(\xi\)</span>, <span class="math notranslate nohighlight">\(B'\)</span> and <span class="math notranslate nohighlight">\(C'\)</span> are now matrices of different sizes.</p>
</div>
<div class="section" id="removal-of-a-line-and-a-column-or-more">
<h2>Removal of a line and a column, or more<a class="headerlink" href="#removal-of-a-line-and-a-column-or-more" title="Permalink to this headline">¶</a></h2>
<p>We remove the last line and column of the matrix <span class="math notranslate nohighlight">\(A\)</span> of size <span class="math notranslate nohighlight">\((n+1)\times (n+1)\)</span>.
Writing:</p>
<div class="math notranslate nohighlight">
\[\begin{split}(A)^{-1}=
\begin{pmatrix}
  F &amp; G\\
  H &amp; I
\end{pmatrix}\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(G\)</span> is a column and <span class="math notranslate nohighlight">\(H\)</span> a line both of size <span class="math notranslate nohighlight">\(n\)</span>,
<span class="math notranslate nohighlight">\(I\)</span> is a scalar,
we get the determinant and the inverse of the new matrix <span class="math notranslate nohighlight">\(A'\)</span> as:</p>
<div class="math notranslate nohighlight">
\[\frac{{\rm Det}A'}{{\rm Det}A}={\rm Det}I,\]</div>
<div class="math notranslate nohighlight">
\[(A')^{-1}=
\begin{pmatrix}
  F - GI^{-1}H
\end{pmatrix}.\]</div>
<p>For the removal of two or more lines and columns, the formulas remain the same, but <span class="math notranslate nohighlight">\(F\)</span>, <span class="math notranslate nohighlight">\(G\)</span>, <span class="math notranslate nohighlight">\(H\)</span>, and <span class="math notranslate nohighlight">\(I\)</span> are now matrices of different sizes.</p>
</div>
<div class="section" id="change-of-a-column">
<h2>Change of a column<a class="headerlink" href="#change-of-a-column" title="Permalink to this headline">¶</a></h2>
<p><span class="math notranslate nohighlight">\(A'\)</span> is the new matrix of size <span class="math notranslate nohighlight">\(n\times n\)</span>, where the last column has been changed:</p>
<p>Writing:</p>
<div class="math notranslate nohighlight">
\[A'=
\begin{pmatrix}
  A_0 &amp; B+\Delta B
\end{pmatrix}.\]</div>
<p>We know the inverse of the old matrix <span class="math notranslate nohighlight">\(A\)</span> (of the same size as <span class="math notranslate nohighlight">\(A'\)</span>):</p>
<div class="math notranslate nohighlight">
\[\begin{split}A^{-1}=
\begin{pmatrix}
  F\\
  G
\end{pmatrix}\end{split}\]</div>
<p>Using the following variables:</p>
<div class="math notranslate nohighlight">
\[M = A^{-1}\Delta B,\]</div>
<p>We have</p>
<div class="math notranslate nohighlight">
\[(A')^{-1} = A^{-1} - \frac{ M G }{ 1 + M_n }\]</div>
<div class="math notranslate nohighlight">
\[\frac{{\rm Det}A'}{{\rm Det}A}= 1 + M_n\]</div>
<p>To ameliorate the precision of the algorithm, the last line of <span class="math notranslate nohighlight">\(A^{-1}\)</span> should only be divided by <span class="math notranslate nohighlight">\(1 + M_n\)</span> and not updated by the general formula.</p>
</div>
<div class="section" id="change-of-a-line">
<h2>Change of a line<a class="headerlink" href="#change-of-a-line" title="Permalink to this headline">¶</a></h2>
<p>It is a straightformward adaptation of the previous section:</p>
<p>Writing:</p>
<div class="math notranslate nohighlight">
\[\begin{split}A'=
\begin{pmatrix}
  A_0 \\ C+\Delta C
\end{pmatrix}.\end{split}\]</div>
<p>We know the inverse of the old matrix <span class="math notranslate nohighlight">\(A\)</span> (of the same size as <span class="math notranslate nohighlight">\(A'\)</span>):</p>
<div class="math notranslate nohighlight">
\[A^{-1}=
\begin{pmatrix}
  F &amp; G
\end{pmatrix}\]</div>
<p>Using the following variables:</p>
<div class="math notranslate nohighlight">
\[M =\Delta C A^{-1},\]</div>
<p>We have</p>
<div class="math notranslate nohighlight">
\[(A')^{-1} = A^{-1} - \frac{ G M }{ 1 + M_n }\]</div>
<div class="math notranslate nohighlight">
\[\frac{{\rm Det}A'}{{\rm Det}A}= 1 + M_n\]</div>
<p>To ameliorate the precision of the algorithm, the last column of <span class="math notranslate nohighlight">\(A^{-1}\)</span> should only be divided by <span class="math notranslate nohighlight">\(1 + M_n\)</span> and not updated by the general formula.</p>
</div>
<div class="section" id="change-of-a-line-and-a-column">
<h2>Change of a line and a column<a class="headerlink" href="#change-of-a-line-and-a-column" title="Permalink to this headline">¶</a></h2>
<p><span class="math notranslate nohighlight">\(A'\)</span> is the new matrix of size <span class="math notranslate nohighlight">\(n\times n\)</span> where the last line and column has been changed:</p>
<p>Writing:</p>
<div class="math notranslate nohighlight">
\[\begin{split}A'=\begin{pmatrix}
A_0 &amp; B \\
C &amp; D \end{pmatrix}.\end{split}\]</div>
<p>We know the inverse of the old matrix <span class="math notranslate nohighlight">\(A\)</span> (of the same size as <span class="math notranslate nohighlight">\(A'\)</span>):</p>
<div class="math notranslate nohighlight">
\[\begin{split}(A)^{-1}=
\begin{pmatrix}
  F &amp; G\\
  H &amp; I
\end{pmatrix}\end{split}\]</div>
<p>Using the following variables:</p>
<div class="math notranslate nohighlight">
\[h = HB, \qquad g=CG,\]</div>
<div class="math notranslate nohighlight">
\[C'=CF, \qquad B'=FB,\]</div>
<div class="math notranslate nohighlight">
\[f=C'B-D=CB'-D, \qquad \xi=gh-If,\]</div>
<div class="math notranslate nohighlight">
\[G'=\xi^{-1}(hG-IB'), \qquad H'=\xi^{-1}(gH-IC'),\]</div>
<div class="math notranslate nohighlight">
\[F' = F-G'C'+\xi^{-1}(fG-gB')H
= F-B'H'+\xi^{-1}G(fH-hC')\]</div>
<p>We get</p>
<div class="math notranslate nohighlight">
\[\begin{split}(A')^{-1}=
\begin{pmatrix}
  F' &amp; G'\\
  H' &amp; \xi^{-1}I
\end{pmatrix}\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\frac{{\rm Det}A'}{{\rm Det}A}=\xi\]</div>
<p>Note that this formulas remain valid if <span class="math notranslate nohighlight">\(A_0\)</span> is not invertible.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="sidebar">
  <div class="container-fluid sidebar-container">
      <div class="row sidebar-row">
        
          <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../gettingstarted.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../applications.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../capiref.html">C++ API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pythonapiref.html">Python API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../community.html">Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../faqs.html">FAQS</a></li>
</ul>

        
      </div>
      <div class="row sidebar-row search-row">
        <div
          class="sidebar-section"
          id="searchbox"
          style="display: none"
          role="search"
        >
          <div class="sidebar-header">
            <a class="sidebar-header-link">Quick search</a>
          </div>
        </div>
        <div class="searchformwrapper">
          <form class="search" action="../../../../search.html" method="get">
            <input type="text" name="q" aria-labelledby="searchlabel" />
            <input type="submit" value="Go" />
          </form>
        </div>
        <script type="text/javascript">
          $("#searchbox").show(0);
        </script>
      </div>
    </div>
  </div>
</div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <footer>
    <div class="container-fluid">
      <div class="row footer">
        <div class="col-xs-12 center-xs middle-xs">
          <div class="outro">
            <p class="footer-description">
              TRIQS (Toolbox for Research on Interacting Quantum Systems) is a
              scientific project providing a set of C++ and Python libraries to
              develop new tools for the study of interacting quantum systems
              based at the Center for Computational Quantum Physics at the
              Flatiron Institute.
            </p>
          </div>
          <ul class="footer-links">
            <li class="footer-link">
              <a exact="true" href="/about.html">About</a>
            </li>
            <li class="footer-link">
              <a
                target="_blank"
                rel="noopener noreferrer"
                href="https://simonsfoundation.org"
                >Simons Foundation</a
              >
            </li>
            <li class="footer-link">
              <a
                target="_blank"
                rel="noopener noreferrer"
                href="https://flatironinstitute.org"
                >Flatiron Institute</a
              >
            </li>
            <li class="footer-link"><a exact="true" href="/">Github</a></li>
            <li class="footer-link">
              <a exact="true" href="/contact">Contact</a>
            </li>
          </ul>
          <p class="updated">Updated on November 20, 2019 (2:20pm)</p>
        </div>
      </div>
    </div>
  </footer>
  
  </body>
</html>