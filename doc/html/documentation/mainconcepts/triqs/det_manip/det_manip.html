
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>The det_manip class &#8212; TRIQS Docs</title>
    <link rel="stylesheet" href="../../../../_static/triqs2.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../../../_static/triqs2.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=default"></script>
    <link rel="author" title="About these documents" href="../../../../about.html" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
  <link rel="stylesheet" href="https://use.typekit.net/hsv6sot.css">
  <script type="text/javascript">try{Typekit.load();}catch(e){}</script>

  </head>
<body class="layout">

  <header class="header">
    <nav class="header-content">
      <div class="row header-row">
        <div class="col-xs-2 logo-col">
          <div class="row start-xs">
            <div class="nav-item">
              <a class="nav-link" href="/"
                ><span class="nav-logo">TRIQS</span></a
              >
            </div>
          </div>
        </div>
        <div class="col-xs-6">
          <div class="row">
            <div class="nav-item">
              <a class="nav-link" href="/documentation.html">Docs</a>
            </div>
            <div class="nav-item">
              <a class="nav-link" href="/tutorials.html">Tutorials</a>
            </div>
            <div class="nav-item">
              <a class="nav-link" href="/applications.html">Applications</a>
            </div>
            <div class="nav-item">
              <a class="nav-link" href="/community.html">Community</a>
            </div>
          </div>
        </div>
        <div class="col-xs-4">
          <div class="row end-xs">
            <div class="nav-item">
              <a class="nav-link" href="/about.html">About</a>
            </div>
            <div class="nav-item">
              <a class="nav-link" target="_blank" rel="noopener noreferrer" href="https://github.com/TRIQS/triqs">Github</a>
            </div>
          </div>
        </div>
      </div>
    </nav>
  </header>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="the-det-manip-class">
<h1>The det_manip class<a class="headerlink" href="#the-det-manip-class" title="Permalink to this headline">¶</a></h1>
<div class="section" id="parameter-construction">
<h2>Parameter &amp; construction<a class="headerlink" href="#parameter-construction" title="Permalink to this headline">¶</a></h2>
<p>The template parameter is the <strong>FunctionType</strong>, the type of F,
which is completely general but has to model the concept</p>
<blockquote>
<div><ul class="simple">
<li><p>return_type: type returned by the function</p></li>
<li><p>argument_type: type of the argument of the function (type of x and y).</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="public-types">
<h2>Public types<a class="headerlink" href="#public-types" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 38%" />
<col style="width: 62%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>name</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>xy_type</p></td>
<td><p>?</p></td>
</tr>
<tr class="row-odd"><td><p>value_type</p></td>
<td><p>?</p></td>
</tr>
<tr class="row-even"><td><p>vector_type</p></td>
<td><p>tqa::vector&lt;value_type&gt;</p></td>
</tr>
<tr class="row-odd"><td><p>matrix_type</p></td>
<td><p>tqa::matrix&lt;value_type&gt;</p></td>
</tr>
<tr class="row-even"><td><p>matrix_view_type</p></td>
<td><p>tqa::matrix_view&lt;value_type</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="public-member-functions">
<h2>Public member functions<a class="headerlink" href="#public-member-functions" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 13%" />
<col style="width: 38%" />
<col style="width: 49%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>return type</p></th>
<th class="head"><p>member function</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
<td><p>det_manip(FunctionType F, size_t init_size)</p></td>
<td><p>constructor</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>det_manip(FunctionType F, ArgumentContainer1 const &amp;X, ArgumentContainer2 const &amp;Y)</p></td>
<td><p>constructor</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>det_manip(det_manip const &amp;)</p></td>
<td><p>constructor</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>det_manip(det_manip &amp;&amp;rhs) noexcept</p></td>
<td><p>constructor</p></td>
</tr>
<tr class="row-even"><td><p>det_manip &amp;</p></td>
<td><p>operator=(const det_manip &amp;)</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>det_manip &amp;</p></td>
<td><p>operator=(det_manip &amp;&amp; rhs) no except</p></td>
<td><p>?</p></td>
</tr>
<tr class="row-even"><td><p>void</p></td>
<td><p>clear()</p></td>
<td><p>put to size 0 (like a vector)</p></td>
</tr>
<tr class="row-odd"><td><p>size_t</p></td>
<td><p>size() const</p></td>
<td><p>current size of the matrix</p></td>
</tr>
<tr class="row-even"><td><p>xy_type const &amp;</p></td>
<td><p>get_x(size_t i) const</p></td>
<td><p>returns the i-th values of x</p></td>
</tr>
<tr class="row-odd"><td><p>xy_type const &amp;</p></td>
<td><p>get_y(size_t j) const</p></td>
<td><p>returns the j-th values of y</p></td>
</tr>
<tr class="row-even"><td><p>value_type</p></td>
<td><p>determinant() const</p></td>
<td><p>determinant</p></td>
</tr>
<tr class="row-odd"><td><p>value_type</p></td>
<td><p>inverse_matrix(size_t i, size_t j) const</p></td>
<td><p>?</p></td>
</tr>
<tr class="row-even"><td><p>matrix_view_type</p></td>
<td><p>inverse_matrix() const</p></td>
<td><p>Returns the inverse matrix. Warning: this is slow, since it create a new copy, and reorder the lines/cols.</p></td>
</tr>
<tr class="row-odd"><td><p>matrix_view_type</p></td>
<td><p>matrix() const</p></td>
<td><p>Rebuild the matrix. Warning: this is slow, since it create a new matrix and re-evaluate the function.</p></td>
</tr>
<tr class="row-even"><td><p>value_type</p></td>
<td><p>try_insert(size_t i, size_t j, xy_type const &amp;x, xy_type const &amp;y)</p></td>
<td><p>returns determinant ratio corresponding to the insertion of an element x-y on line i, column j without actually doing it. In particular, does not change determinant size.</p></td>
</tr>
<tr class="row-odd"><td><p>template&lt;typename Fx, typename Fy&gt; value_type</p></td>
<td><p>try_insert_from_function (size_t i, size_t j, Fx fx, Fy fy, value_type const ksi)</p></td>
<td><p>?</p></td>
</tr>
<tr class="row-even"><td><p>value_type</p></td>
<td><p>try_insert2 (size_t i0, size_t i1, size_t j0, size_t j1, xy_type const &amp;x0, xy_type const &amp;x1, xy_type const &amp;y0, xy_type const &amp;y1)</p></td>
<td><p>?</p></td>
</tr>
<tr class="row-odd"><td><p>value_type</p></td>
<td><p>try_remove (size_t i, size_t j)</p></td>
<td><p>?</p></td>
</tr>
<tr class="row-even"><td><p>value_type</p></td>
<td><p>try_remove2 (size_t i0, size_t i1, size_t j0, size_t j1)</p></td>
<td><p>?</p></td>
</tr>
<tr class="row-odd"><td><p>value_type</p></td>
<td><p>try_change_col (size_t j, xy_type const &amp;y)</p></td>
<td><p>?</p></td>
</tr>
<tr class="row-even"><td><p>value_type</p></td>
<td><p>try_change_row (size_t i, xy_type const &amp;x)</p></td>
<td><p>?</p></td>
</tr>
<tr class="row-odd"><td><p>void</p></td>
<td><p>complete_operation()</p></td>
<td><p>?</p></td>
</tr>
<tr class="row-even"><td><p>int</p></td>
<td><p>roll_matrix (RollDirection roll)</p></td>
<td><p>?</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="synopsis">
<h2>Synopsis<a class="headerlink" href="#synopsis" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>The possible operations on the matrix M are:</p></li>
</ul>
<table class="docutils align-default">
<colgroup>
<col style="width: 27%" />
<col style="width: 73%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Operation</p></th>
<th class="head"><p>Effect</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>insert</p></td>
<td><p>adding a line and a column</p></td>
</tr>
<tr class="row-odd"><td><p>remove</p></td>
<td><p>removing a line and a column</p></td>
</tr>
<tr class="row-even"><td><p>insert2</p></td>
<td><p>adding 2 lines and 2 columns</p></td>
</tr>
<tr class="row-odd"><td><p>remove2</p></td>
<td><p>removing 2 lines and 2 columns</p></td>
</tr>
<tr class="row-even"><td><p>change_col</p></td>
<td><p>changing one <em>y</em></p></td>
</tr>
<tr class="row-odd"><td><p>change_raw</p></td>
<td><p>changing one <em>x</em></p></td>
</tr>
</tbody>
</table>
<ul>
<li><p>Each operation <em>OP</em> is called in two steps:</p>
<ul>
<li><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">value_type</span> <span class="n">try_OP</span><span class="p">(</span><span class="n">arguments</span> <span class="p">...)</span>
</pre></div>
</div>
<p>Returns the ratio</p>
<div class="math notranslate nohighlight">
\[\frac{det M'}{det M}\]</div>
<p>where M’ would be the matrix after the operation is completed.</p>
<p>try_OP <strong>does NOT</strong> modify the matrix <span class="math notranslate nohighlight">\(M\)</span>.</p>
</li>
<li><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="n">complete_operation</span><span class="p">()</span>
</pre></div>
</div>
<p>Complete the last operation OP (the last called try_OP), by updating the list of x and y
and the inverse of the matrix to <span class="math notranslate nohighlight">\((M')^{-1}\)</span>.</p>
</li>
</ul>
</li>
<li><p>This structure is designed to write  Monte Carlo algorithms:</p>
<ul class="simple">
<li><p>the try part of the move calls some try_OP</p></li>
<li><p>if and only if the move is accepted, is the complete_operation called.</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="under-the-hood">
<h2>Under the hood …<a class="headerlink" href="#under-the-hood" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>All matrix algebra is made with BLAS calls.</p></li>
<li><p>The storage is done in a compact way: when a column or row is added,
no data are shifted, it is added at the end of the matrix.
However, the permutation of row and columns are handled by this class
so that this is transparent for the user.</p></li>
</ul>
</div>
<div class="section" id="full-documentation-manual-triqs">
<h2>Full documentation/manual/triqs<a class="headerlink" href="#full-documentation-manual-triqs" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>In construction</p>
</div>
<div class="toctree-wrapper compound">
</div>
</div>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;triqs/det_manip/det_manip.hpp&gt;</span><span class="cp"></span>

<span class="k">struct</span> <span class="n">fun</span> <span class="p">{</span>

  <span class="k">typedef</span> <span class="kt">double</span> <span class="n">result_type</span><span class="p">;</span>
  <span class="k">typedef</span> <span class="kt">double</span> <span class="n">argument_type</span><span class="p">;</span>

  <span class="kt">double</span> <span class="nf">operator</span><span class="p">()(</span><span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">y</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="k">const</span> <span class="kt">double</span> <span class="n">pi</span>   <span class="o">=</span> <span class="n">acos</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="p">);</span>
    <span class="k">const</span> <span class="kt">double</span> <span class="n">beta</span> <span class="o">=</span> <span class="mf">10.0</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">double</span> <span class="n">epsi</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">tau</span>        <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">y</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">s</span>            <span class="o">=</span> <span class="p">(</span><span class="n">tau</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">tau</span>               <span class="o">=</span> <span class="p">(</span><span class="n">s</span> <span class="o">?</span> <span class="nl">tau</span> <span class="p">:</span> <span class="n">beta</span> <span class="o">+</span> <span class="n">tau</span><span class="p">);</span>
    <span class="kt">double</span> <span class="n">r</span>          <span class="o">=</span> <span class="n">epsi</span> <span class="o">+</span> <span class="n">tau</span> <span class="o">/</span> <span class="n">beta</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">epsi</span><span class="p">);</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="n">beta</span><span class="p">)</span> <span class="o">/</span> <span class="n">std</span><span class="o">::</span><span class="n">sin</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">r</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>

  <span class="n">fun</span> <span class="n">f</span><span class="p">;</span>
  <span class="n">triqs</span><span class="o">::</span><span class="n">det_manip</span><span class="o">::</span><span class="n">det_manip</span><span class="o">&lt;</span><span class="n">fun</span><span class="o">&gt;</span> <span class="n">D</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>

  <span class="c1">/// insertions of 3 lines and 3 columns</span>
  <span class="kt">double</span> <span class="n">x</span> <span class="o">=</span> <span class="mf">2.</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mf">9.</span><span class="p">,</span> <span class="n">detratio</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">D</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="n">detratio</span> <span class="o">=</span> <span class="n">D</span><span class="p">.</span><span class="n">try_insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">D</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="n">D</span><span class="p">.</span><span class="n">complete_operation</span><span class="p">();</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">D</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="n">detratio</span> <span class="o">=</span> <span class="n">D</span><span class="p">.</span><span class="n">try_insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">);</span>
  <span class="n">D</span><span class="p">.</span><span class="n">complete_operation</span><span class="p">();</span>
  <span class="n">detratio</span> <span class="o">=</span> <span class="n">D</span><span class="p">.</span><span class="n">try_insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">);</span>
  <span class="n">D</span><span class="p">.</span><span class="n">complete_operation</span><span class="p">();</span>

  <span class="c1">/// removal of a line (the 3rd) and a column (the 2nd)</span>
  <span class="n">detratio</span> <span class="o">=</span> <span class="n">D</span><span class="p">.</span><span class="n">try_remove</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
  <span class="n">D</span><span class="p">.</span><span class="n">complete_operation</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="sidebar">
  <div class="container-fluid sidebar-container">
      <div class="row sidebar-row">
        <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../gettingstarted.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mainconcepts.html">Main Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../applications.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../capiref.html">C++ API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pythonapiref.html">Python API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../faqs.html">FAQS</a></li>
</ul>

      </div>
      <div class="row sidebar-row search-row">
        <div
          class="sidebar-section"
          id="searchbox"
          style="display: none"
          role="search"
        >
          <div class="sidebar-header">
            <a class="sidebar-header-link">Quick search</a>
          </div>
        </div>
        <div class="searchformwrapper">
          <form class="search" action="../../../../search.html" method="get">
            <input type="text" name="q" aria-labelledby="searchlabel" />
            <input type="submit" value="Go" />
          </form>
        </div>
        <script type="text/javascript">
          $("#searchbox").show(0);
        </script>
      </div>
    </div>
  </div>
</div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <footer>
    <div class="container-fluid">
      <div class="row footer">
        <div class="col-xs-12 center-xs middle-xs">
          <p class="updated">Updated on November 20, 2019 (2:20pm)</p>
          <div class="outro">
            <p class="footer-description">
              TRIQS (Toolbox for Research on Interacting Quantum Systems) is a
              scientific project providing a set of C++ and Python libraries to
              develop new tools for the study of interacting quantum systems based
              at the Center for Computational Quantum Physics at the Flatiron
              Institute.
            </p>
          </div>
          <ul class="footer-links">
            <li class="footer-link">
              <a exact="true" href="/about.html">About</a>
            </li>
            <li class="footer-link">
              <a
                target="_blank"
                rel="noopener noreferrer"
                href="https://simonsfoundation.org"
                >Simons Foundation</a
              >
            </li>
            <li class="footer-link">
              <a
                target="_blank"
                rel="noopener noreferrer"
                href="https://flatironinstitute.org"
                >Flatiron Institute</a
              >
            </li>
            <li class="footer-link"><a exact="true" href="/">Github</a></li>
            <li class="footer-link"><a exact="true" href="/contact">Contact</a></li>
          </ul>
        </div>
      </div>
    </div>
  </footer>

  </body>
</html>